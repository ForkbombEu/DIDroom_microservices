# - par
# - authorize
# - token
# - 
version: "1.1"
name: test all the microservices
env:
  mz_host: localhost:3003
  path_to_wallet: /mobile_zencode
  ci_host: localhost:3001/credential_issuer
  as_host: localhost:3000/authz_server
  verifier_host: localhost:3002/verifier
#  verifier_host: localhost:3004
tests:
  happy_flow_dc+sd-jwt:
    name: Happy flow with dc+sd-jwt credential (issuance and verification)
    $ref: test/happy_flow_dc+sd-jwt.yml
  happy_flow_ldp_vc:
    name: Happy flow with ldp_vc credential (issuance and verification)
    $ref: test/happy_flow_ldp_vc.yml
  failing_presentation:
    name: Failing flow by presenting a wrong ldp_vc (type does not match dcql_query)
    $ref: test/failing_presentation.yml
  failing_authorize:
    name: Failing flow not authorized by custom code (wrong email)
    $ref: test/failing_authorize.yml

  creation:
    name: PAR endpoint
    steps:
      - http:
          url: http://${{env.as_host}}/par
          method: POST
          headers:
            "Content-Type": "application/x-www-form-urlencoded"
          body:
            response_type=code&client_id=did%3Adyne%3Asandbox.genericissuer%3A6Cp8mPUvJmQaMxQPSnNyhb74f9Ga4WqfXCkBneFgikm5&state=xyz&authorization_details=%5B%7B%22type%22%3A%22openid_credential%22%2C%22locations%22%3A%5B%22http%3A%2F%2F${{env.ci_host}}%22%5D%2C%22credential_configuration_id%22%3A%22test_credential%22%7D%5D&code_challenge=E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM&code_challenge_method=S256&redirect_uri=didroom%3A%2F%2Fopenwallet-credential&client_secret=eyJhbGciOiJFUzI1NiJ9.eyJzdWIiOiJwaXBwbyJ9.hiVPL2JTdmcZY7Vcso95KUBEzcTGvmvQ7wlwkCo0G74Unpzny2drvLsu-HzHWyckKbRjwWox-V5gqqKeka8kEQ
          check:
            co2:
              - lte: 0.01 # in grams
            status: 201
