on:
  push:
    branches:
      - 'main'
      - 'stable'
  pull_request:
  merge_group:

jobs:
  api_test:
    runs-on: ubuntu-latest
    name: ğŸ§ª VCI API Tests
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v4
      - run: make test

  publish_docker_image:
    needs: api_test
    name: ğŸ³ Publish Docker Image
    if: github.ref == 'refs/heads/stable' && github.event_name != 'pull_request'
    uses: interfacerproject/workflows/.github/workflows/publish-ghcr.yml@main
    secrets: inherit
